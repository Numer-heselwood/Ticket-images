<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üñºÔ∏è Ticket Viewer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body class="container py-4">
  <h2 class="text-center mb-4">üñºÔ∏è Ticket Image Viewer</h2>

  <div class="text-center mb-3">
    <input type="text" id="ticketInput" class="form-control mb-3" placeholder="Enter Ticket Number" />
    <button class="btn btn-success w-100" onclick="loadImages()">üîç Search</button>
  </div>

  <div id="gallery" class="row g-3"></div>

  <button id="darkToggle" class="btn btn-sm btn-secondary position-fixed top-0 end-0 m-3" onclick="toggleTheme()">üåô</button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // === DARK MODE ===
    function toggleTheme() {
      const html = document.documentElement;
      const current = html.getAttribute("data-bs-theme");
      html.setAttribute("data-bs-theme", current === "dark" ? "light" : "dark");
    }

    // === AUTO REFRESH EVERY 30s ===
    setInterval(() => {
      const ticket = document.getElementById("ticketInput").value.trim();
      if (ticket) loadImages();
    }, 30000);

    // === LOAD IMAGES ===
    async function loadImages() {
      const ticket = document.getElementById("ticketInput").value.trim();
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";

      if (!ticket) {
        gallery.innerHTML = "<div class='text-muted'>Please enter a ticket number.</div>";
        return;
      }

      const formData = new FormData();
      formData.append("ticket_number", ticket);

      const res = await fetch("/get_images", { method: "POST", body: formData });
      const data = await res.json();

      if (data.error) {
        gallery.innerHTML = `<div class='text-danger'>${data.error}</div>`;
        return;
      }

      if (!data.images || data.images.length === 0) {
        gallery.innerHTML = "<div class='text-warning'>No images found.</div>";
        return;
      }

      data.images.forEach((url) => {
        const col = document.createElement("div");
        col.classList.add("col-12", "col-md-4");
        col.innerHTML = `<img src="${url}" class="img-fluid rounded shadow-sm" alt="Ticket Image">`;
        gallery.appendChild(col);
      });
    }
  </script>
</body>
</html>
